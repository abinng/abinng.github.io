class EasyDanmaku{constructor(options){this.container=document.querySelector(options.el);this.options={line:parseInt(options.line,10)||10,speed:options.speed||10,hover:options.hover,loop:options.loop,colourful:options.colourful,coefficient:options.coefficient||1,textShadow:options.textShadow||1};this.colors=['#FFFFFF','#FFFFFF','#FE0302','#FF7204','#FFAA02','#00CD00','#4266BE','#CC0273','#CC3333','#0099CC','#FF6666'];this.tracks=new Array(this.options.line).fill(true);this.danmakuQueue=[];this.timer=null;this.isPaused=false;this.init()}init(){if(this.container){this.container.style.position='fixed';this.container.style.top='60px';this.container.style.left='0';this.container.style.width='100%';this.container.style.height='calc(100% - 60px)';this.container.style.pointerEvents='none';this.container.style.zIndex='999';this.container.style.overflow='hidden'}let containerHeight=this.container?this.container.offsetHeight:0;if(containerHeight===0){containerHeight=window.innerHeight-60}this.trackHeight=containerHeight/this.options.line;if(!this.trackHeight||this.trackHeight<=0)this.trackHeight=40}batchSend(dataList,isLoop=false){let index=0;const sendNext=()=>{if(this.isPaused)return;if(index>=dataList.length){if(this.options.loop)index=0;else return}const item=dataList[index];this.send(item);index++};if(this.timer)clearInterval(this.timer);const interval=1000/this.options.coefficient;this.timer=setInterval(()=>{if(Math.random()>0.1)sendNext()},interval)}send(item){if(!this.container)return;const rand=Math.random();let type='scroll';if(rand>0.95)type='bottom';else if(rand>0.90)type='top';const dom=document.createElement('div');dom.innerText=item.content;this.setStyle(dom,type);if(type==='scroll'){this.renderScroll(dom)}else{this.renderStatic(dom,type)}}setStyle(dom,type){dom.style.position='absolute';dom.style.whiteSpace='nowrap';dom.style.fontFamily='"黑体", "Heiti SC", sans-serif';dom.style.fontWeight='bold';dom.style.fontSize=`${Math.floor(22+Math.random()*6)}px`;if(this.options.textShadow===1){dom.style.textShadow='#000 1px 0 1px, #000 0 1px 1px, #000 0 -1px 1px, #000 -1px 0 1px'}else{dom.style.textShadow='1px 1px 2px rgba(0,0,0,0.8)'}dom.style.pointerEvents='auto';dom.style.cursor='default';dom.style.zIndex=10;if(this.options.colourful){const color=this.colors[Math.floor(Math.random()*this.colors.length)];dom.style.color=color}else{dom.style.color='#FFFFFF'}}renderScroll(dom){const availableTracks=[];this.tracks.forEach((isFree,index)=>{if(isFree)availableTracks.push(index)});let trackIndex=-1;if(availableTracks.length>0){const randomPos=Math.floor(Math.random()*availableTracks.length);trackIndex=availableTracks[randomPos]}else{trackIndex=Math.floor(Math.random()*this.options.line)}this.tracks[trackIndex]=false;setTimeout(()=>{this.tracks[trackIndex]=true},2000);const topPos=trackIndex*this.trackHeight;dom.style.top=`${topPos}px`;dom.style.left='100%';dom.style.transform='translateX(0)';this.container.appendChild(dom);const containerWidth=this.container.offsetWidth||window.innerWidth;const duration=this.options.speed+(Math.random()*2);const animation=dom.animate([{transform:'translateX(0)'},{transform:`translateX(-${containerWidth+dom.offsetWidth+50}px)`}],{duration:duration*1000,easing:'linear'});if(this.options.hover){dom.addEventListener('mouseenter',()=>{animation.pause();dom.style.zIndex=100;dom.style.border="1px solid rgba(255,255,255,0.5)";dom.style.backgroundColor="rgba(0,0,0,0.4)";dom.style.borderRadius="4px"});dom.addEventListener('mouseleave',()=>{animation.play();dom.style.zIndex=10;dom.style.border="none";dom.style.backgroundColor="transparent"})}animation.onfinish=()=>{dom.remove()}}renderStatic(dom,type){dom.style.left='50%';dom.style.transform='translateX(-50%)';dom.style.zIndex=20;dom.style.textShadow='none';dom.style.background='rgba(0,0,0,0.6)';dom.style.borderRadius='20px';dom.style.padding='4px 12px';dom.style.border=`1px solid ${dom.style.color}`;const offset=Math.floor(Math.random()*this.options.line)*this.trackHeight;if(type==='top'){dom.style.top=`${offset+20}px`}else{dom.style.top='auto';dom.style.bottom=`${offset+80}px`}this.container.appendChild(dom);setTimeout(()=>{dom.remove()},5000)}}